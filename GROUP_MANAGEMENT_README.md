# Система групового управління цілями

## Огляд

Додано функціонал групового управління цілями на карті Leaflet з підтримкою десктопних та мобільних пристроїв.

## Основні можливості

### 1. Групове виділення цілей

- **Shift + клік**: Натисніть Shift і клікніть по цілі для додавання до групи
- **Виділення рамкою**: Натисніть Shift і потягніть мишкою для створення рамки виділення
- **Long press (мобільні)**: Утримуйте палець на цілі протягом 500ms для виділення
- **Ctrl+A**: Виділити всі цілі
- **Escape**: Зняти всі виділення

### 2. Панель управління групою

Після виділення цілей знизу екрану з'являється панель управління з такими функціями:

#### Зміна швидкості
- Встановіть нову швидкість для всіх виділених цілей (0-30000 км/год)

#### Зміна курсу
- Встановіть новий курс для всіх виділених цілей (0-359°)

#### Зміна типу
- Змініть тип для всіх виділених цілей
- Доступні типи: Шахед, МіГ-31К, Су-35, Ту-95МС, та інші

#### Видалення групи
- Видаліть всі виділені цілі одночасно

### 3. Візуальні ефекти

#### Неонова підсвітка
Виділені цілі отримують яскраву неонову підсвітку з пульсацією:
- Подвійний drop-shadow ефект
- Анімація pulse-selected (1.5s)
- Збільшений z-index для відображення поверх інших елементів

#### Glass-ефект панелі
Панель управління має сучасний glass-morphism дизайн:
- Backdrop blur (20px)
- Напівпрозорий фон
- Неонова межа зверху
- Тіні для глибини

### 4. Мобільна адаптація

#### Свайп-жести
- Свайп вниз на панелі для закриття (100px threshold)

#### Крупні кнопки
- Мінімальна висота кнопок 44px для зручності натискання
- Адаптивна сітка для різних розмірів екранів

#### Тактильна відповідь
- Вібрація при виділенні цілі (якщо підтримується)

## Технічна реалізація

### Глобальні змінні

```javascript
let selectedTargets = new Set(); // ID виділених цілей
let isShiftPressed = false;
let isBoxSelectionMode = false;
let boxSelectionStart = null;
let selectionBox = null;
let longPressTimer = null;
let touchStartPos = null;
let groupActionsPanel = null;
```

### Основні функції

#### `initGroupManagement()`
Ініціалізує систему групового управління:
- Створює панель управління
- Налаштовує обробники подій для клавіатури
- Додає обробники для box selection
- Налаштовує мобільні жести

#### `selectTarget(targetId)`
Виділяє ціль:
- Додає ID до `selectedTargets`
- Додає CSS клас `selected-target-marker` для візуального ефекту

#### `deselectTarget(targetId)`
Знімає виділення з цілі

#### `clearSelection()`
Знімає виділення з усіх цілей та приховує панель

#### `updateGroupPanel()`
Оновлює панель управління:
- Показує/приховує панель залежно від кількості виділених цілей
- Оновлює лічильник виділених цілей

### Групові операції

#### `changeGroupSpeed()`
Відкриває форму для зміни швидкості групи

#### `applyGroupSpeed()`
Застосовує нову швидкість до всіх виділених цілей

#### `changeGroupCourse()`
Відкриває форму для зміни курсу групи

#### `applyGroupCourse()`
Застосовує новий курс до всіх виділених цілей

#### `changeGroupType()`
Відкриває форму для зміни типу групи

#### `applyGroupType()`
Застосовує новий тип до всіх виділених цілей та оновлює іконки

#### `deleteGroupTargets()`
Видаляє всі виділені цілі з підтвердженням

## CSS класи

### `.group-actions-panel`
Основна панель управління групою внизу екрану

### `.selected-target-marker`
Застосовується до виділених маркерів для неонового ефекту

### `.selection-box`
Рамка виділення при box selection

### `.group-action-btn`
Кнопки дій над групою

## Інтеграція

Система автоматично інтегрується з існуючим кодом:

1. Викликається з `initApp()` через `initGroupManagement()`
2. Обробники кліків додаються до маркерів в `addTargetToMap()`
3. Використовує існуючі функції: `deleteTarget()`, `updateMarkerRotation()`, `saveTargets()`

## Приклад використання

### Десктоп
1. Увійдіть як адміністратор
2. Натисніть Shift і клікніть по кількох цілях
3. З'явиться панель знизу екрану
4. Оберіть дію (змінити швидкість, курс, тип або видалити)
5. Введіть нові дані та натисніть "Застосувати"

### Мобільний
1. Увійдіть як адміністратор
2. Утримуйте палець на цілі 500ms для виділення
3. Повторіть для інших цілей
4. Використовуйте кнопки на панелі знизу
5. Свайпніть вниз на панелі для закриття

## Налаштування

### Час для long press
Змініть в `handleTouchStart()`:
```javascript
longPressTimer = setTimeout(() => {
    // ...
}, 500); // 500ms - можна змінити
```

### Threshold для свайпу
Змініть в обробнику touchmove панелі:
```javascript
if (deltaY > 100) { // 100px - можна змінити
    clearSelection();
}
```

### Візуальні ефекти
Налаштуйте в CSS:
```css
.selected-target-marker {
    filter: drop-shadow(0 0 15px var(--accent)) 
            drop-shadow(0 0 25px var(--accent)) !important;
    animation: pulse-selected 1.5s ease-in-out infinite;
}
```

## Сумісність

- ✅ Chrome/Edge (desktop & mobile)
- ✅ Firefox (desktop & mobile)
- ✅ Safari (desktop & mobile)
- ✅ Підтримка touch events
- ✅ Підтримка keyboard shortcuts
- ✅ Responsive design

## Обмеження

- Групове управління доступне лише для адміністраторів
- Необхідне активне з'єднання з Firebase для синхронізації змін
- Long press може конфліктувати з нативним context menu на деяких пристроях

## Майбутні покращення

- [ ] Додати undo/redo для групових операцій
- [ ] Зберігати групи виділення між сеансами
- [ ] Додати швидке виділення за типом цілі
- [ ] Експорт/імпорт виділених цілей
- [ ] Історія групових операцій
